#!/bin/bash
set -e

# Skip hooks if SKIP_GIT_HOOKS=1 is set
if [ "${SKIP_GIT_HOOKS:-0}" = "1" ]; then
    echo "[pre-commit] Skipped (SKIP_GIT_HOOKS=1)"
    exit 0
fi

echo "╔══════════════════════════════════════╗"
echo "║       pre-commit quality gate        ║"
echo "╚══════════════════════════════════════╝"

# 1. Format check
echo ""
echo "▶ Checking formatting (cargo +nightly fmt)..."
cargo +nightly fmt --all -- --check
echo "  ✓ Formatting OK"

# 2. Clippy lint
echo ""
echo "▶ Running clippy..."
cargo +nightly clippy --all-targets -- -D warnings
echo "  ✓ Clippy OK"

echo ""
echo "✅ pre-commit passed"
